{% extends 'base/base.html' %}
{% load static %}

{% block content %}
 {% csrf_token %}
 <template id="optionsSelector">
      <div x-data="optionsSelector">
        <div>
          <h4 x-text="title"></h4>
          <template x-for="(div, divIndex) of divs" :key="divIndex">
            <div>
              <select x-model="div.option">
                <option disabled value="">Выберите значение</option>
                <template
                  x-for="option in availableOptions"
                  :key="option.value"
                >
                  <option
                    x-bind:disabled="uniqueOptions && divs.find((div) => parseInt(div.option) === option.value) !== undefined"
                    x-bind:value="option.value"
                    x-text="option.label"
                  ></option>
                </template>
              </select>
              <input
                @change="onSubmit"
                type="number"
                placeholder="Количество"
                x-model="div.count"
              />
              <button @click="onDeleteDiv(divIndex)">Удалить</button>
              <template
                x-if="$data.dropdownOption && dropdownOption === parseInt(div.option) && parseInt(div.count) > 0"
              >
                <div>
                  <template x-for="i in parseInt(div.count)" :key="i">
                    <div>
                      <input type="text" x-model="div.dropdownValues[i - 1]" />
                    </div>
                  </template>
                </div>
              </template>

              <template x-if="$data.customFields && customFields.length > 0">
                <div>
                  <template
                    x-for="(customField, customFieldIndex) in customFields"
                    :key="customFieldIndex"
                  >
                    <div>
                      <input
                        @change="onSubmit"
                        type="text"
                        x-model="div.customFields[customField.name]"
                        x-bind:placeholder="customField.placeholder"
                        x-bind:value="customField.initialValue"
                      />
                    </div>
                  </template>
                </div>
              </template>
            </div>
          </template>

          <!-- asdf -->
          <!-- <div>

            </div> -->
          <!-- </template> -->
          <button @click="onAddDiv" x-text="addButtonLabel"></button>
        </div>
      </div>
    </template>

    <div x-data="app">
      <x-component
        template="optionsSelector"
        x-data="{
        title: 'Услуги',
        divs: components.services,
        uniqueOptions: true,
        addButtonLabel: 'Добавить услугу',
        dropdownOption: 3,
        availableOptions: [
        {% for service in services %}
        {
            label: '{{ service.name }} - {{ service.price }}',
            value: '{{ service.id }}',
        },
        {% endfor %}
        ]
    }"
      ></x-component>

      <x-component
        template="optionsSelector"
        x-data="{
        title: 'Товары',
        divs: components.film,
        uniqueOptions: true,
        addButtonLabel: 'Добавить пленку',

        dropdownOption: 1,
        availableOptions: [
        {% for storage_item in storage_items %}
        {
            label: '{{ storage_item.item.product_name }} - {{ storage_item.item.price }}',
            value: '{{ item.id }}',
        }
        {% endfor %}
        ]
    }"
      ></x-component>

      <x-component
        template="optionsSelector"
        x-data="{
        title: 'Печать',
        divs: components.print,
        uniqueOptions: false,
        dropdownOption: 1,
        addButtonLabel: 'Добавить печать',
        availableOptions: [
         {% for print_price in print_prices %}
        {
            label: '{{ print_price.paper_size }} - {{ print_price.paper_type }}, {{ print_price.price }}',
            value: '{{ print_price.id }}',
        },
        {% endfor %}
       ],
        customFields: [
        {
            placeholder: 'Код',
            name: 'code',
            initialValue: '',
        },  {
            placeholder: 'Номер кадра',
            name: 'frame_number',
            initialValue: '1',
        }]
    }"
      ></x-component>

      <br />
      <br />
      <button @click="onSubmit" x-text="submitButtonLabel"></button>
    </div>


{% endblock %}

{% block scripts %}
     <script src="{% static 'dist/order.js' %}"></script>
     <!-- Библиотека aplinejs-component для создания переиспользуемых компонентов на Alpine.js -->
<script defer src="https://unpkg.com/alpinejs-component@latest/dist/component.min.js"></script>

<!-- Библиотека Alpine.js последней версии -->
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
{% endblock %}